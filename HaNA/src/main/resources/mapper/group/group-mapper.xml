<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="group">

	<select id="selectOneGroup" resultType="group">
		select
			*
		from
			group_
		 where
		 	group_id = #{groupId}
	</select>
	<insert id="insertOneGroup">
		insert into
			group_
		values(
    		#{groupId},
    		#{groupName},
    		#{leaderId},
    		default,
    		default,
    		#{hashtag},
    		#{image}
		)
		
	</insert>
	
	<select id="selectGroupEnrolled" resultMap="groupMemberListMap">
		select
			* 
		from
			group_member_list
		where
			group_id = #{groupId}
			and
		member_id = #{memberId}
	</select>
	
	<resultMap type="map" id="groupMemberListMap">
		<result column="group_id" property="groupId"/>
        <result column="member_id" property="memberId"/>
        <result column="member_level_code" property="memberLevelCode"/>
	</resultMap>
	
	<select id="selectGroupList" resultType="group">
	select
    	g.*
	from
    	group_ g join group_member_list gml
        	on g.group_id = gml.group_id
	where
    	gml.member_id = #{id}
	</select>

	<insert id="insertGroupBoard">
		insert into
			group_board
		values(
			seq_group_board.nextVal,
			#{groupId},
			#{writer},
			#{content},
			default,
			default,
			#{placeName},
			#{placeAddress},
			#{locationY},
			#{locationX},
			#{image},
			#{tagMembers}			
		)
		<selectKey order="AFTER" resultType="_int" keyProperty="no">  <!-- insert문 이후에 실행할게요, GroupBoard객체의 no필드에 세팅할게요 -->
			select
				seq_group_board.currval
			from
				dual
		</selectKey>
	</insert>
	<select id="selectOneBoard" resultType="groupBoard">
		select
			g.*,
			m.picture writer_profile
		from
			group_board g join member m
			on g.writer = m.id
		where
			g.no = #{no}
	</select>
	<select id="selectMemberList" resultType="member">
		select
			*
		from
			member
		where
			id in 
			<foreach collection="tagMembers" item="id" open="(" separator="," close=")">
				#{id}
			</foreach>	
	</select>
	<select id="selectGroupMemberList" resultType="member">
		select
			id, name, picture
		from
			member m join group_member_list gml
			on m.id = gml.member_id
		where
			gml.group_id = #{groupId}
	</select>
	
	<select id="selectGroupBoardList" resultType="groupBoard">
	select
		*
	from
		group_board
	where
		group_id = #{groupId}
	order by no desc
	</select>
	<insert id="insertGroupBoardComment">
		insert into
			group_board_comment
		values(
			seq_group_board_comment.nextval,
			#{boardNo},
			#{commentLevel},
			#{writer},
			#{content},
			<choose>
				<when test="commentRef eq 0">
					null,
				</when>
				<otherwise>
					#{commentRef},
				</otherwise>
			</choose>
			default
		)
	</insert>
	
</mapper>

